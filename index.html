<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>ssssnake</title>
    <style>
        body {
            padding-top: 20px;
            margin-top: 0;
            text-align: center;
            background-color: cadetblue;
            /*background-color: #879372;*/
            overflow: hidden;
        }

        canvas {
            border: 5px solid black;
            box-shadow: 0 0 10px gray;
        }

        span {
            margin: 20px;
            font-weight: bolder;
            float: left;
        }

        /*button{
            width: 40px;
            height: 50px;
        }
        div{
            display: inline;
            vertical-align: bottom;
            margin-left: auto;
            margin-right: auto;
            width: 100px;
            margin-top: 20px;
        }
        #btn1,#btn2{
            float: left;
        }
        #btn1{
            margin-left: 70px;
        }
        #btn3,#btn4{
            float: right;
        }
        #btn4{
            margin-right: 70px;
        }*/
        div {
            display: none;
        }

        @media screen and (max-width: 600px) {
            body {
                height: 750;
            }

            #stop {
                padding-left: 25px;
            }

            canvas {
                width: 300px;
                height: 380px;
            }

            div {
                display: block;
                margin-top: 15px;
            }

            button {
                width: 70px;
                height: 70px;
                border-radius: 25px;
                outline: none;
                box-shadow: -4px -4px 10px -8px rgba(255, 255, 255, 1),
                    4px 4px 10px -8px rgba(0, 0, 0, .3);
            }

            button:active {
                box-shadow: -4px -4px 10px -8px rgba(255, 255, 255, 1) inset,
                    4px 4px 10px -8px rgba(0, 0, 0, .3) inset;
            }

            #btn1,
            #btn2 {
                margin: auto;
            }

            #btn3,
            #btn4 {
                margin: 5px;
                margin-left: 35px;
                margin-right: 35px;
            }
        }
    </style>
</head>

<body onload="draw()">
    <span id="stop">STOP</span>
    <span id="restart">RESTART</span>
    <span id="score"></span>
    <canvas id="canvas" width=800 height=600>
        ä½ çš„æµè§ˆå™¨éœ€è¦æ›´æ–°~
    </canvas>
    <div>
        <button id="btn1">ğŸ‘†</button><br>
        <button id="btn3">ğŸ‘ˆ</button>
        <button id="btn4">ğŸ‘‰</button><br>
        <button id="btn2">ğŸ‘‡</button>
    </div>
    <script>
        function draw() {
            var canvas = document.getElementById("canvas");

            if (canvas.getContext) {
                var ctx = canvas.getContext("2d");
                var isEatFood = false;
                var timer; //å®šæ—¶å™¨
                var old_dir; //å®šä¹‰ä¸€ä¸ªä»£è¡¨åŸæ–¹å‘çš„å˜é‡ï¼Œå½“å¼€å…³å‘ç”Ÿå˜åŒ–ï¼ŒåŸæ–¹å‘è·Ÿç€å˜åŒ–ï¼Œç„¶åè¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœåŸæ–¹å‘ä¸æ–°æ–¹å‘ç›¸åŒï¼Œå°±è¿”å›false
                var runing = "RUN";

                //åˆ†æ•°
                var score = 0;
                var scorez = document.getElementById("score");
                scorez.innerHTML = "SCORE: " + score;
                var score = 0;

                //æŒ‰é”®æ§åˆ¶è›‡çš„æ–¹å‘
                var btn1 = document.getElementById("btn1");
                var btn2 = document.getElementById("btn2");
                var btn3 = document.getElementById("btn3");
                var btn4 = document.getElementById("btn4");
                var stop = document.getElementById("stop");
                var restart = document.getElementById("restart");

                //åˆ›å»ºçŸ©å½¢å¯¹è±¡
                function Rect(x, y, width, height, color) {
                    this.x = x;
                    this.y = y;
                    this.width = width;
                    this.height = height;
                    this.color = color;
                }

                //ç»˜åˆ¶çŸ©å½¢çš„æ–¹æ³•
                Rect.prototype.rDraw = function () {
                    ctx.beginPath();
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    ctx.strokeRect(this.x, this.y, this.width, this.height);
                }

                //åˆ›å»ºsnakeå¯¹è±¡
                function Snake() {
                    //ç”»è›‡å¤´
                    this.head = new Rect(canvas.width / 2 - 20, canvas.height / 2 - 20, 20, 20, "red");
                    //ç”»è›‡èº«
                    this.body = new Array();

                    var x = this.head.x - 20;
                    var y = this.head.y;

                    for (var i = 0; i < 3; i++) {
                        var rect = new Rect(x, y, 20, 20, "black");
                        this.body.push(rect);
                        x -= 20;
                    }
                    this.direction = 2;
                    old_dir = "R";
                }

                //ç»˜åˆ¶è›‡çš„æ–¹æ³•ï¼ˆåŒ…å«è›‡å¤´è›‡èº«ï¼‰
                Snake.prototype.sDraw = function () {
                    //ç»˜åˆ¶è›‡å¤´
                    this.head.rDraw();
                    //ç»˜åˆ¶è›‡èº«
                    for (var i = 0; i < this.body.length; i++) {
                        this.body[i].rDraw();
                    }
                }

                var snake = new Snake();
                snake.sDraw();
                var food = randForFood();

                //è›‡ç§»åŠ¨çš„æ–¹æ³•
                Snake.prototype.move = function () {
                    //åŠ å¤´
                    var rect = new Rect(this.head.x, this.head.y, this.head.width, this.head.height, "black");
                    this.body.splice(0, 0, rect);

                    //å»å°¾
                    if (isEatFood == false) {
                        this.body.pop();
                    } else {
                        isEatFood = false;
                    }

                    switch (this.direction) {
                        case 0: {
                            this.head.x -= this.head.width;
                            old_dir = "L";
                            break;
                        }
                        case 1: {
                            this.head.y -= this.head.height;
                            old_dir = "U";
                            break;
                        }
                        case 2: {
                            this.head.x += this.head.width;
                            old_dir = "R";
                            break;
                        }
                        case 3: {
                            this.head.y += this.head.height;
                            old_dir = "D";
                            break;
                        }
                    }

                    //åˆ¤æ–­è›‡å¤´ä¸å¢™æ˜¯å¦ä¼šç¢°æ’
                    if (this.head.x >= canvas.width || this.head.x < 0 || this.head.y >= canvas.height || this.head
                        .y < 0) {
                        clearInterval(timer);
                        timer = null;
                        alert("Game over:D");
                        restart.onclick = function () {
                            window.location.reload();
                        }
                    }

                    //åˆ¤æ–­è›‡å¤´ä¸è›‡èº«æ˜¯å¦é‡å 
                    for (var i = 0; i < this.body.length; i++) {
                        if (isRectHit(this.head, this.body[i])) {
                            clearInterval(timer);
                            timer = null;
                            alert("Game over:D");
                        }
                    }
                }

                //åŠ¨ç”»æ•ˆæœ
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    food.rDraw();
                    snake.move();
                    snake.sDraw();

                    if (isRectHit(snake.head, food)) {
                        isEatFood = true;
                        food = randForFood();
                        score += 1;
                        scorez.innerHTML = "SCORE: " + score;
                    }
                }
                var speed = 200;
                timer = setInterval(animate, speed);

                //ç¢°æ’æ£€æµ‹
                function isRectHit(rect1, rect2) {
                    var minX1 = rect1.x;
                    var minX2 = rect2.x;
                    var minY1 = rect1.y;
                    var minY2 = rect2.y;

                    var maxX1 = rect1.x + rect1.width;
                    var maxX2 = rect2.x + rect2.width;
                    var maxY1 = rect1.y + rect1.height;
                    var maxY2 = rect2.y + rect2.height;

                    //åˆ¤æ–­çŸ©å½¢ç›¸äº¤çš„æœ€å¤§/æœ€å°å€¼
                    var minX = Math.max(minX1, minX2);
                    var minY = Math.max(minY1, minY2);
                    var maxX = Math.min(maxX1, maxX2);
                    var maxY = Math.min(maxY1, maxY2);

                    if (minX < maxX && minY < maxY) {
                        return true;
                    } else {
                        return false;
                    }
                }

                //éšæœºé£Ÿç‰©
                function randForFood() {
                    var isInSnake = true;
                    while (isInSnake) {

                        var x = getRandInRange(0, (canvas.width - 40) / 40) * 40;
                        var y = getRandInRange(0, (canvas.height - 40) / 40) * 40;
                        //é£Ÿç‰©çŸ©å½¢
                        var rect = new Rect(x, y, 20, 20, "green");

                        //åˆ¤æ–­é£Ÿç‰©æ˜¯å¦ä¸è›‡å¤´é‡å 
                        if (isRectHit(snake.head, rect)) {
                            isInSnake = true;
                            contiue;
                        }

                        isInSnake = false;


                        //åˆ¤æ–­é£Ÿç‰©æ˜¯å¦ä¸è›‡èº«é‡å 
                        for (var i = 0; i < snake.body.length; i++) {
                            if (isRectHit(snake.body[i], rect)) {
                                isInSnake = true;
                                break;
                            }
                        }
                    }
                    return rect;
                }

                //è·å–éšæœºæ•°çš„æ–¹æ³•
                function getRandInRange(min, max) {
                    return Math.round(Math.random() * (max - min) + min);
                }

                //ç›‘å¬é”®ç›˜äº‹ä»¶
                document.onkeydown = function (event) {
                    var event = event || windw.event;
                    // 37 Leftï¼ˆå·¦ç®­å¤´ï¼‰ 38 Upï¼ˆä¸Šç®­å¤´   39 Rightï¼ˆå³ç®­å¤´  40 Downï¼ˆä¸‹ç®­å¤´ï¼‰
                    /*speed = 150;
                    timer = setInterval(animate,speed);
                    clearInterval(timer);*/
                    switch (event.keyCode) {
                        case 37: {
                            if (old_dir != "R") {
                                snake.direction = 0;
                                break;
                            }
                            return false;
                        }
                        case 38: {
                            if (old_dir != "D") {
                                snake.direction = 1;
                                break;
                            }
                            return false;
                        }
                        case 39: {
                            if (old_dir != "L") {
                                snake.direction = 2;
                                break;
                            }
                            return false;
                        }
                        case 40: {
                            if (old_dir != "U") {
                                snake.direction = 3;
                                break;
                            }
                            return false;
                        }
                    }
                }
                /*document.onkeypress = function(){
                    var event = event || windw.event;
                    if(event.keyCode == 37 || event.keyCode == 38 || event.keyCode == 39 || event.keyCode == 40){
                        speed = 500;
                    }
                }*/
                btn1.onclick = function () {
                    if (old_dir != "D") {
                        snake.direction = 1;
                    }
                    return false;
                }
                btn2.onclick = function () {
                    if (old_dir != "U") {
                        snake.direction = 3;
                    }
                    return false;
                }
                btn3.onclick = function () {
                    if (old_dir != "R") {
                        snake.direction = 0;
                    }
                    return false;
                }
                btn4.onclick = function () {
                    if (old_dir != "L") {
                        snake.direction = 2;
                    }
                    return false;
                }
                stop.onclick = function () {
                    if (runing == "RUN") {
                        clearInterval(timer);
                        runing = "STOP";
                    }
                }
                restart.onclick = function () {
                    if (runing == "STOP") {
                        timer = setInterval(animate, speed);
                        runing = "RUN";
                    }
                }
            }
        }
    </script>


</body>

</html>
